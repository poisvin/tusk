<%= turbo_frame_tag "modal-content" do %>
  <div class="bg-background-dark border border-slate-800 rounded-t-2xl sm:rounded-2xl overflow-hidden">
    <!-- Header -->
    <div class="flex items-center justify-between p-4 border-b border-slate-800">
      <button
        type="button"
        class="text-slate-400 hover:text-white"
        data-action="modal#close"
      >
        Cancel
      </button>
      <h2 class="text-white font-semibold">
        <%= @note.new_record? ? 'New Note' : 'Edit Note' %>
      </h2>
      <button
        type="submit"
        form="note-form"
        class="text-primary font-semibold hover:text-blue-400"
      >
        Save
      </button>
    </div>

    <!-- Form -->
    <%= form_with model: @note, id: "note-form", class: "p-4 overflow-y-auto max-h-[calc(90vh-60px)]", data: { turbo_frame: "_top" } do |f| %>
      <!-- Title -->
      <div class="mb-4">
        <%= f.text_field :title,
            placeholder: "Note title",
            class: "w-full bg-slate-800/50 border #{@note.errors[:title].any? ? 'border-red-500' : 'border-slate-700'} rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-primary" %>
        <% if @note.errors[:title].any? %>
          <p class="text-red-500 text-sm mt-1"><%= @note.errors[:title].first %></p>
        <% end %>
      </div>

      <!-- Content -->
      <div class="mb-4">
        <label class="text-slate-400 text-sm mb-2 block">Content</label>
        <%= f.text_area :content,
            rows: 8,
            class: "w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-primary resize-none" %>
      </div>

      <!-- Category -->
      <div class="mb-4">
        <label class="text-slate-400 text-sm mb-2 block">Category</label>
        <div class="flex gap-2" data-controller="button-group" data-button-group-field-value="note_category">
          <% Note.categories.keys.each do |cat| %>
            <%
              icons = { 'personal' => 'person', 'work' => 'work', 'ideas' => 'lightbulb' }
            %>
            <button
              type="button"
              class="flex-1 py-2 px-4 rounded-lg border transition-all flex items-center justify-center gap-2 <%= @note.category == cat ? 'bg-primary/20 border-primary text-primary' : 'bg-slate-800/50 border-slate-700 text-slate-400 hover:border-slate-600' %>"
              data-action="button-group#select"
              data-value="<%= cat %>"
            >
              <span class="material-symbols-outlined text-base"><%= icons[cat] %></span>
              <%= cat.humanize %>
            </button>
          <% end %>
          <%= f.hidden_field :category, data: { button_group_target: "field" } %>
        </div>
      </div>

      <!-- Tags -->
      <% if @tags.any? %>
        <div class="mb-4">
          <label class="text-slate-400 text-sm mb-2 block">Tags</label>
          <div class="flex flex-wrap gap-2">
            <% @tags.each do |tag| %>
              <label class="cursor-pointer">
                <%= f.check_box :tag_ids,
                    { multiple: true, checked: @note.tag_ids.include?(tag.id), class: "hidden peer" },
                    tag.id, nil %>
                <span
                  class="px-3 py-1 rounded-full text-sm transition-all peer-checked:bg-primary peer-checked:text-white bg-slate-800 text-slate-400 hover:bg-slate-700"
                  <%= "style='background-color: #{tag.color}'" if @note.tag_ids.include?(tag.id) && tag.color.present? %>
                >
                  <%= tag.name %>
                </span>
              </label>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- Delete Button (only when editing) -->
      <% unless @note.new_record? %>
        <div class="pt-4 border-t border-slate-800">
          <%= button_to note_path(@note),
              method: :delete,
              form: { data: { turbo_confirm: "Are you sure you want to delete this note?" } },
              class: "w-full py-3 rounded-lg border border-red-500/30 text-red-500 hover:bg-red-500/10 transition-all flex items-center justify-center gap-2" do %>
            <span class="material-symbols-outlined">delete</span>
            Delete Note
          <% end %>
        </div>
      <% end %>
    <% end %>
  </div>
<% end %>
